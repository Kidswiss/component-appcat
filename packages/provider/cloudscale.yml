classes:
  - .common

parameters:

  pkg.provider.cloudscale:
    images:
      provider-cloudscale:
        registry: ghcr.io
        repository: vshn/provider-cloudscale/provider
        tag: v0.3.0

  crossplane:
    providers:
      cloudscale:
        package: ${pkg.provider.cloudscale:images:provider-cloudscale:registry}/${pkg.provider.cloudscale:images:provider-cloudscale:repository}:${pkg.provider.cloudscale:images:provider-cloudscale:tag}
    providerConfigs:
      cloudscale:
        apiVersion: cloudscale.crossplane.io/v1
        spec:
          credentials:
            source: InjectedIdentity
            apiTokenSecretRef:
              name: cloudscale-api-token
              namespace: ${crossplane:namespace}

  appcat:
    secrets:
      cloudscale-api-token:
        metadata:
          namespace: ${crossplane:namespace}
        stringData:
          CLOUDSCALE_API_TOKEN: '?{vaultkv:${cluster:tenant}/${cluster:name}/appcat/objectstorage/provider-cloudscale/token}'

    additionalResources:
      provider-cloudscale-secrets-objectsuser:
        apiVersion: v1
        kind: Namespace
