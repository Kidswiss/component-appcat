# Overwrite parameters here

parameters:
  appcat:
    secrets:
      test-secret:
        metadata:
          namespace: test-namespace
        stringData:
          key: value

    additionalResources:
      test-namespace:
        apiVersion: v1
        kind: Namespace

    composites:
      "test.appcat.vshn.io":
        spec:
          group: appcat.vshn.io
          names:
            kind: XTest
            plural: xtest
          claimNames:
            kind: Test
            plural: tests
          versions:
            - name: v1
              schema:
                openAPIV3Schema:
                  type: object

    compositions:
      test-composition:
        spec:
          compositeTypeRef:
            apiVersion: appcat.vshn.io/v1
            kind: XTest
          writeConnectionSecretsToNamespace: crossplane-system
          patchSets:
            - name: annotations
              patches:
                - type: FromCompositeFieldPath
                  fromFieldPath: metadata.annotations
            - name: labels
              patches:
                - type: FromCompositeFieldPath
                  fromFieldPath: metadata.labels
          resources:

            - base:
                apiVersion: kubernetes.crossplane.io/v1alpha1
                kind: Object
                spec:
                  managementPolicy: Observe
                  forProvider:
                    manifest:
                      apiVersion: v1
                      kind: Namespace
                      metadata:
                        name: '' # patched
                  providerConfigRef:
                    name: provider-config
              patches:
                # set which namespace to observe
                - fromFieldPath: metadata.labels[crossplane.io/claim-namespace]
                  toFieldPath: spec.forProvider.manifest.metadata.name
                # copy the appuio organization label to a label on the XR
                - type: ToCompositeFieldPath
                  fromFieldPath: status.atProvider.manifest.metadata.labels[appuio.io/organization]
                  toFieldPath: metadata.labels[appuio.io/organization]
                # append suffix to the observer name
                - fromFieldPath: metadata.labels[crossplane.io/composite]
                  toFieldPath: metadata.name
                  transforms:
                    - type: string
                      string:
                        fmt: "%s-ns-observer"
